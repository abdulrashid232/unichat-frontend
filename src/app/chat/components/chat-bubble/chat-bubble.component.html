<div class="flex items-start space-x-3" [class.flex-row-reverse]="message.sender === 'user'" [class.space-x-reverse]="message.sender === 'user'">
  <!-- Avatar -->
  @if (message.sender === 'user') {
  <div class="flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-gray-700 to-gray-900 dark:from-gray-600 dark:to-gray-800 flex items-center justify-center shadow-md">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
    </svg>
  </div>
  } @else {
  <div class="flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center shadow-md">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white" viewBox="0 0 20 20" fill="currentColor">
      <path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z" />
    </svg>
  </div>
  }

  <!-- Message Content -->
  <div class="flex-1 min-w-0 max-w-[85%] md:max-w-[75%]">
    <!-- Header -->
    <div class="flex items-center space-x-2 mb-1.5" [class.justify-end]="message.sender === 'user'">
      <span class="text-xs font-medium text-gray-700 dark:text-gray-300">
        {{ message.sender === "user" ? "You" : "UniChat AI" }}
      </span>
      @if (message.topic) {
      <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300">
        {{ message.topic }}
      </span>
      }
      <span class="text-xs text-gray-500 dark:text-gray-500">
        {{ message.timestamp | date : "shortTime" }}
      </span>
    </div>

    <!-- Message Bubble -->
    <div 
      class="rounded-2xl p-4 shadow-sm border transition-all duration-200 hover:shadow-md"
      [ngClass]="{
        'bg-gradient-to-br from-gray-800 to-gray-900 dark:from-gray-700 dark:to-gray-800 text-white border-gray-700 dark:border-gray-600 rounded-tr-sm': message.sender === 'user',
        'bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-gray-100 dark:border-gray-700 rounded-tl-sm': message.sender !== 'user'
      }"
    >
      <markdown 
        class="prose prose-sm max-w-none dark:prose-invert"
        [ngClass]="{
          'prose-invert': message.sender === 'user'
        }"
        [data]="message.text"
      ></markdown>
    </div>
  </div>
</div>
